### HTTPS

https在http的基础上多加了TLS层做一个安全的保障。在三次握手之后还需要进行TLS协议的握手

另外http的端口号是80，https的是443

在通信上是用了混合加密的，首先非对称加密的方式交换会话密钥，之后对称的用会话密钥通信

### TLS握手

具体的协议流程

1. 客户端向服务器索要公钥
2. 双方协商产生会话密钥
3. 使用会话密钥加密通信

TLS的有四次通信

1. 第一次，客户端发起，在本地生成一个随机数，随后向服务端发出client hello，这次要包含第一个生成的随机数，TLS版本和密码套件
2. 服务端在本地也产生一个随机数，回应一个ack，之后发出serverHello，这个里面要包含服务端生成的随机数，TLS版本号，使用密码套件，一份证书（证书里附有公钥），之后serverhello结束
3. 客户端返回ack，在客户端此时还会生成一个随机数，会算出会话密钥，利用三个随机数算出会话密钥，然后利用公钥加密传输到服务器，这次通信就是client key exchange，之后还会通知服务端，之后使用会话密钥通信，非堆成加密部结束。
4. 服务器会响应一个信息，通知握手结束。

非对称加密的算法有RSA，但是现在多用ECDHE，对称加密多是AES。摘要算法一般是SHA384用于产生随机数和消息认证

### 证书验证

证书通常包含：

+ 公钥
+ 持有信息
+ CA（证书机构）信息
+ CA对这份文件的数字签名和使用的算法
+ 证书有效期
+ 额外信息

证书的签发流程

1. ⾸先 CA 会把持有者的公钥、用途、颁发者、有效时间等信息打成⼀个包，然后对这些信息进⾏ Hash 计算， 得到⼀个 Hash 值；
2. 然后 CA 会使用自己的私钥将该 Hash 值加密，⽣成 Certificate Signature，也就是 CA 对证书做了签名
3. 最后将 Certificate Signature 添加在文件证书上，形成数字证书；

客户端校验

1. ⾸先客户端会使⽤同样的 Hash 算法获取该证书的 Hash 值 H1；
2. 通常浏览器和操作系统中集成了 CA 的公钥信息，浏览器收到证书后可以使⽤ CA 的公钥解密 Certificate Signature 内容，得到⼀个 Hash 值 H2 ；
3. 最后比较 H1 和 H2，如果值相同，则为可信赖的证书，否则则认为证书不可信。

通常证书验证一般是链式的，我们申请的证书一般不是根证书发的，一般都是由中间机构，但是这中间可以构成一个信任链，可以用上层证书的公钥解密下层，信任链式传递。

一般根证书会被预制到操作系统或者浏览器中
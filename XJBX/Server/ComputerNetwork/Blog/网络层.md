## IP

网络层主要是实现机器间的通信，点对点。相比而言，mac的作用是两个直连设备间的通信，ip主要是负责在没有直连的两个网络间进行通信。

### 相关定义和基础

IP（v4）地址是32位正整数，在计算机中二进制，为了看起来像个人看的才用点分10进给你看的。

最多允许2<sup>32</sup>台机器连接网络

实际看这是不够的哈，会根据⼀种可以更换 IP 地址的技术NAT ，使得可连接计算机数超过 43 亿台

### 地址分类

一共5类，A类、B类、C类、D类、E类，从上到小

![11](./Pic/11.png)

具体地址范围如下

| 类别 |          地址范围           | 最大主机数 |
| :--: | :-------------------------: | :--------: |
|  A   |  0.0.0.0 - 127.255.255.255  |  16777214  |
|  B   | 128.0.0.0 - 191.255.255.255 |   65534    |
|  C   | 192.0.0.0 - 223-255.255.255 |    254     |

计算方式就是看主机号的，比如c类的话(减2是因为全1和全0是特殊地址)

2<sup>8</sup> - 2 = 254

其中主机号全1指定某个网络下的广播地址，全0指定某个网络

⽽ D 类和 E 类地址是没有主机号的，所以不可⽤于主机 IP，D 类常被⽤于多播，E 类是预留的分类，暂时未使 ⽤。

### 分类的优点

能用状态机比较快的判断出当前地址属于哪一类

### 无分类地址

其实分类不一定能和实际问题的范围匹配，所以提出了CIDR地址，前面网络号，后面主机号

```
a.b.c.d/x
```

其中x表示前x位属于网络号，剩下的几位是主机号

还有一种就是子网掩码，主机号的部分全0，和ip与之后就拿到了网络号

### 关于IP分片与重组

每种数据链路的最⼤传输单元MTU 都是不相同的，如 FDDI 数据链路MTU4352、以太⽹的 MTU 是 1500 字节等。

其中，我们最常⻅数据链路是以太⽹，它MTU是1500字节，大于他的时候IP就会进行分片，重组的时候只能由目标主机进行重组，路由器是不会做这的

在分⽚传输中，⼀旦某个分⽚丢失，则会造成整个 IP 数据报作废，所以 TCP上有 MSS 也就是在 TCP 层进行分片不由 IP 层分⽚，那么对于 UDP 我们尽量不要发送⼀个大于MTU的数据报文。


## 内存池实现

在服务器端，recv，parse，send三个流程的时候，需要频繁的malloc和free的话，这个是很损失性能的。而且malloc可能失败，导致业务代码逻辑很复杂，这个时候就可以借助内存池这个组件，来做内存方面的操作。比较好用的就是tcmalloc和jemalloc。ngx里面的内存池也有

### 具体实现

任何结构的实现都大致分为三步

1. 数据结构 + 宏定义一些替换
2. 相应的方法，对外的函数
3. 测试的方法，提供相关的验证

### 结构体的实现

考虑两点

1. 小块内存的分配
2. 大块内存的分配

内存的一个页是4k（操作系统可能有区别），小于4k的定义成小内存，大于4k的定义成大内存。

第一个难题是如何把一个个小块的内存组织到4k，简而言之就是把小碎片内存结合到4k。一个可行的办法就是给这个4k的内存块两个哨兵，一个start，一个end。

```
struct node{
	unsigned int* start;
	unsigned int* end;
	struct node* next;
	int flag;
};
```

第二个问题就是大块的内存如何处理，可以参考ngx的处理方式，分配的时候如果没有空闲的就分配，回收的时候不归还给系统，挂在大块内存链表的后边，用链表组织一个结构。

